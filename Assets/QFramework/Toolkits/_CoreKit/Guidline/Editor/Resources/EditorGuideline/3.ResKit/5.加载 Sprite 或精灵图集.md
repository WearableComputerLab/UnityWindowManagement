# QFramework 使用指南 2020（十一）：Res Kit（5）加载 Sprite 或精灵图集

在上一篇我们简单讨论了 加载资源时是否需要传入 AssetBundle 名字的问题。

在这一篇，我们聊聊 AssetBundle 存在的一个通病，加载精灵的问题。

## AssetBundle 中加载精灵

我们先准备一个图片，如需哦图所示。
![image.png](http://file.liangxiegame.com/d97acd6e-263f-4f8d-99af-1318a32c4f96.png)

我们把它标记为 AssetBundle，标记后如下图所示:
![image.png](http://file.liangxiegame.com/304d86c5-3a93-43fb-b736-956b77d5e4c1.png)

接着，我们在脚本中直接进行加载。

代码如下所示:
``` csharp
var sprite = mResLoader.LoadSync<Sprite> ("TestSprite");
var spriteRenderer = GetComponent<SpriteRenderer>();
spriteRenderer.sprite = sprite;
```


大家注意，我们是使用 `LoadSync<Sprite>`  加载的图片。
运行结果为，不显示任何结果，如下所示：

![image.png](http://file.liangxiegame.com/e0b43706-2117-42aa-87a2-f58d5eeec2e2.png)

说明没有加载成功。

为什么呢？

因为，现在我们是处于 模拟模式 下。

在模拟模式中，加载的是 Assets 目录下的资源，而在 Assets 目录中 TestSprite 图片是 Texture2D 类型。

为了解决这个问题，ResLoader 提供了 LoadSprite 这个 API，我们把代码改成如下:
``` csharp
var sprite = mResLoader.LoadSprite ("TestSprite");
var spriteRenderer = GetComponent<SpriteRenderer>();
spriteRenderer.sprite = sprite;
```

运行的结果如下:
![image.png](http://file.liangxiegame.com/0156a88f-63ce-4dd9-a38c-2f3aabed6862.png)
场景中有了图片。

这样在模拟模式下，加载 Sprite 就加载成功了。

接下来我们看下非模拟模式下。

## 非模拟模式下
我们把环境切到非模拟模式，如下图所示:
![image.png](http://file.liangxiegame.com/1603b5c1-0f7b-485e-a8e1-f93f202e1c5a.png)

环境切换成功后，我们需打 AB 包，点击上图中的 "打 AB 包" 按钮。
![image.png](http://file.liangxiegame.com/37673692-45af-4e56-ab7f-2e9c7b177ac6.png)

打包成功后，看到如下输出，说明打包成功了:
![image.png](http://file.liangxiegame.com/b7d23d65-4f14-4918-b883-e5f9a777e3d6.png)
Success Save AssetDataTable，而下边的错误可以忽略。

之后我们再运行，加载脚本:
``` csharp
var sprite = mResLoader.LoadSprite ("TestSprite");
var spriteRenderer = GetComponent<SpriteRenderer>();
spriteRenderer.sprite = sprite;
```

看下结果:
![image.png](http://file.liangxiegame.com/d3f2cd3d-b333-46a2-ad60-2dde9aef2f11.png)

结果是没有加载成功。

这是为什么呢？

相信大家在使用 Res Kit 的时候都遇到过这样的问题。

这是因为，如果想从 AssetBundle 中加载 Sprite 类型的资源，需要将图片打图集，否则它是 Texture2D 类型的。

我们先看下 TestSprite 的 Inspector。

![image.png](http://file.liangxiegame.com/631f5618-d1f1-4f65-bbc2-d9af0e1c0502.png)

打图集的方式很简单，只需要在 Packing Tag 栏上起个名字即可。
![image.png](http://file.liangxiegame.com/fa9ddc4b-a1b8-4d9f-b84a-9d25907d1fc2.png)


接着再打一次 AB 包。

之后运行场景。

结果如下:
![image.png](http://file.liangxiegame.com/5e0c2b6e-74e2-4c1d-b44b-7ea0083a8856.png)

说明加载成功了。

这样，关于在 AssetBundle 中加载 Sprite 坑就算填上了。

## 小结
* Res Kit 中推荐使用 LoadSprite 加载 Sprite 类型
* 非模拟模式下：精灵图片必须要输入 Packing Tag（打图集)

这是 Unity AssetBundle 的坑，不是 Res Kit 的坑，望周知。

* 转载请注明地址：凉鞋的笔记：liangxiegame.com。
* 任何问题欢迎到 QQ 群：623597263 交流。

  
  